# ğŸ—ï¸ é¡¹ç›®é‡ç»„æ€»ç»“æŠ¥å‘Š

## ğŸ“… é‡ç»„æ—¶é—´
**æ‰§è¡Œæ—¶é—´**: 2025å¹´1æœˆ

## ğŸ¯ é‡ç»„ç›®æ ‡
åŸºäºå¯¹GRUç½‘ç»œæ¢¯åº¦ä¼ æ’­çš„æ·±å…¥åˆ†æï¼Œå°†é¡¹ç›®é‡ç»„ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„ç½‘ç»œï¼š
1. **ä»·æ ¼é¢„æµ‹ç½‘ç»œ** - ä¸“é—¨ä¼˜åŒ–ä»·æ ¼é¢„æµ‹èƒ½åŠ›
2. **ç­–ç•¥ç½‘ç»œ** - åŸºäºä»·æ ¼ç‰¹å¾å­¦ä¹ äº¤æ˜“ç­–ç•¥

## ğŸ§  æŠ€æœ¯èƒŒæ™¯

### æ¢¯åº¦ä¼ æ’­é—®é¢˜åˆ†æ
```python
# åŸé—®é¢˜ï¼šargmaxä¸å¯å¯¼ï¼Œé˜»æ–­æ¢¯åº¦ä¼ æ’­
expected_position = position_logits.argmax()  # âŒ æ¢¯åº¦é˜»æ–­
gru_input = cat([features, expected_position])
strategy_state = gru_cell(gru_input, strategy_state)

# å®é™…æ¢¯åº¦è·¯å¾„ï¼š
# final_loss â†’ position_logits âœ…
# position_logits â†’ expected_position âŒ (argmaxé˜»æ–­)
# expected_position â†’ gru_input âŒ
# gru_input â†’ strategy_state âŒ
```

### å†…å­˜å¼€é”€é—®é¢˜
- **GRUçŠ¶æ€é“¾**: éœ€è¦ä¿å­˜20å¤©çš„è®¡ç®—å›¾
- **å†…å­˜å ç”¨**: ~5å€åŸºç¡€å†…å­˜ï¼ˆå¹¶éå®Œå…¨é¿å…ï¼‰
- **è®¡ç®—æ•ˆç‡**: é€’å½’è®¡ç®—é™åˆ¶å¹¶è¡ŒåŒ–

## ğŸ—ï¸ æ–°æ¶æ„è®¾è®¡

### ğŸ“Š ä¸¤é˜¶æ®µè§£è€¦è®­ç»ƒ

```
é˜¶æ®µ1: ä»·æ ¼é¢„æµ‹ç½‘ç»œè®­ç»ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é‡‘èæ•°æ® [180, 11]              â”‚
â”‚         â†“                       â”‚
â”‚ Transformer Encoder             â”‚
â”‚         â†“                       â”‚
â”‚ ä»·æ ¼é¢„æµ‹å¤´ â†’ æœªæ¥7å¤©ä»·æ ¼         â”‚
â”‚ ç‰¹å¾æå–å¤´ â†’ ç­–ç•¥ç‰¹å¾ [d_model]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ2: ç­–ç•¥ç½‘ç»œè®­ç»ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç­–ç•¥ç‰¹å¾ [20, d_model] (å†»ç»“)   â”‚
â”‚         â†“                       â”‚
â”‚ GRUç­–ç•¥ç½‘ç»œ (20å¤©é€’å½’)          â”‚
â”‚         â†“                       â”‚
â”‚ ä»“ä½å†³ç­– â†’ 0-10ä»“ä½             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ–°ç›®å½•ç»“æ„

```
Quantification/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ price_prediction/           # ä»·æ ¼é¢„æµ‹ç½‘ç»œæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ price_transformer.py    # ä»·æ ¼é¢„æµ‹Transformer
â”‚   â”œâ”€â”€ strategy_network/           # ç­–ç•¥ç½‘ç»œæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ gru_strategy.py         # GRUç­–ç•¥ç½‘ç»œ
â”‚   â”‚   â”œâ”€â”€ strategy_loss.py        # ç­–ç•¥æŸå¤±å‡½æ•°
â”‚   â”‚   â””â”€â”€ strategy_trainer.py     # ç­–ç•¥è®­ç»ƒå™¨
â”‚   â”œâ”€â”€ attention.py                # å…±äº«ç»„ä»¶
â”‚   â”œâ”€â”€ feedforward.py
â”‚   â”œâ”€â”€ config.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ train.py                        # ä¸¤é˜¶æ®µè®­ç»ƒå…¥å£
â”œâ”€â”€ train_price_network.py          # ä»·æ ¼ç½‘ç»œè®­ç»ƒ
â”œâ”€â”€ train_strategy_network.py       # ç­–ç•¥ç½‘ç»œè®­ç»ƒ
â””â”€â”€ ...
```

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### 1. **å®Œå…¨è§£è€¦**
- ä»·æ ¼é¢„æµ‹ç½‘ç»œç‹¬ç«‹è®­ç»ƒå’Œä¼˜åŒ–
- ç­–ç•¥ç½‘ç»œåŸºäºå†»ç»“çš„ä»·æ ¼ç‰¹å¾è®­ç»ƒ
- ä¸¤ä¸ªç½‘ç»œå¯ä»¥ç‹¬ç«‹è°ƒä¼˜å’Œéƒ¨ç½²

### 2. **æ¢¯åº¦ä¼ æ’­æ¸…æ™°**
```python
# ä»·æ ¼ç½‘ç»œï¼šæ ‡å‡†ç›‘ç£å­¦ä¹ 
price_loss = mse_loss(price_pred, price_target)
price_loss.backward()  # æ¢¯åº¦å®Œæ•´ä¼ æ’­

# ç­–ç•¥ç½‘ç»œï¼šåŸºäºæ”¶ç›Šçš„å¼ºåŒ–å­¦ä¹ 
strategy_loss = -relative_return + risk_cost + opportunity_cost
strategy_loss.backward()  # åªä¼˜åŒ–ç­–ç•¥å‚æ•°
```

### 3. **ä¸“ä¸šåŒ–æŸå¤±å‡½æ•°**

#### ä»·æ ¼ç½‘ç»œæŸå¤±
```python
class PricePredictionLoss:
    - MSEæŸå¤±ï¼ˆä»·æ ¼é¢„æµ‹ç²¾åº¦ï¼‰
    - MAEæŸå¤±ï¼ˆç»å¯¹è¯¯å·®ï¼‰
    - æ–¹å‘å‡†ç¡®ç‡ï¼ˆæ¶¨è·Œæ–¹å‘ï¼‰
```

#### ç­–ç•¥ç½‘ç»œæŸå¤±
```python
class StrategyLoss:
    - ç›¸å¯¹åŸºå‡†æ”¶ç›Šï¼ˆvså¸‚åœºåŸºå‡†ï¼‰
    - é£é™©æˆæœ¬ï¼ˆæ³¢åŠ¨ç‡+å›æ’¤+è°ƒä»“æˆæœ¬ï¼‰
    - æœºä¼šæˆæœ¬ï¼ˆç‰›å¸‚ä½ä»“ä½+ç†Šå¸‚é«˜ä»“ä½ï¼‰
```

### 4. **è®­ç»ƒæ•ˆç‡æå‡**
- ä»·æ ¼ç½‘ç»œï¼šå¯ä»¥ä½¿ç”¨å¤§æ‰¹æ¬¡å¹¶è¡Œè®­ç»ƒ
- ç­–ç•¥ç½‘ç»œï¼šåªéœ€è®­ç»ƒGRUéƒ¨åˆ†ï¼Œå‚æ•°é‡æ›´å°‘
- ç‰¹å¾æå–ï¼šä¸€æ¬¡è®¡ç®—ï¼Œå¤šæ¬¡ä½¿ç”¨

## ğŸš€ è®­ç»ƒæµç¨‹

### ç¬¬ä¸€é˜¶æ®µï¼šä»·æ ¼é¢„æµ‹ç½‘ç»œ
```bash
python train_price_network.py
```
- **ç›®æ ‡**: æœ€å¤§åŒ–ä»·æ ¼é¢„æµ‹ç²¾åº¦
- **æ•°æ®**: å†å²ä»·æ ¼ â†’ æœªæ¥ä»·æ ¼
- **è¾“å‡º**: `best_price_network.pth`

### ç¬¬äºŒé˜¶æ®µï¼šç­–ç•¥ç½‘ç»œ
```bash
python train_strategy_network.py
```
- **ç›®æ ‡**: æœ€å¤§åŒ–äº¤æ˜“ç­–ç•¥æ”¶ç›Š
- **æ•°æ®**: ä»·æ ¼ç‰¹å¾ â†’ ä»“ä½å†³ç­–
- **è¾“å‡º**: `best_strategy_network.pth`

### ä¸€é”®è®­ç»ƒ
```bash
python train.py              # å®Œæ•´ä¸¤é˜¶æ®µè®­ç»ƒ
python train.py price        # åªè®­ç»ƒä»·æ ¼ç½‘ç»œ
python train.py strategy     # åªè®­ç»ƒç­–ç•¥ç½‘ç»œ
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | åŸè€¦åˆæ–¹æ¡ˆ | æ–°è§£è€¦æ–¹æ¡ˆ |
|------|------------|------------|
| **æ¢¯åº¦ä¼ æ’­** | éƒ¨åˆ†é˜»æ–­ | å®Œå…¨ç•…é€š |
| **å†…å­˜æ•ˆç‡** | ~5å€å¼€é”€ | ~2å€å¼€é”€ |
| **è®­ç»ƒé€Ÿåº¦** | æ…¢ï¼ˆé€’å½’é™åˆ¶ï¼‰ | å¿«ï¼ˆå¹¶è¡Œå‹å¥½ï¼‰ |
| **æ¨¡å‹è°ƒä¼˜** | å›°éš¾ï¼ˆè€¦åˆï¼‰ | ç®€å•ï¼ˆç‹¬ç«‹ï¼‰ |
| **ä¸“ä¸šåŒ–ç¨‹åº¦** | ä½ï¼ˆæ··åˆç›®æ ‡ï¼‰ | é«˜ï¼ˆä¸“é—¨ä¼˜åŒ–ï¼‰ |

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ä»·æ ¼ç½‘ç»œç‰¹å¾æå–
```python
def extract_features(self, financial_data):
    with torch.no_grad():  # ç­–ç•¥è®­ç»ƒæ—¶å†»ç»“
        outputs = self.forward(financial_data, return_features=True)
        return outputs["strategy_features"]  # [batch, d_model]
```

### ç­–ç•¥ç½‘ç»œGRUè®­ç»ƒ
```python
def forward_sequence(self, price_features_sequence):
    # price_features_sequence: [batch, 20, d_model]
    strategy_state = self.init_strategy_state(batch_size)
    
    for day in range(20):
        # æ¯å¤©åŸºäºä»·æ ¼ç‰¹å¾å’Œç­–ç•¥çŠ¶æ€åšå†³ç­–
        position_output = self.position_head(
            cat([price_features_sequence[:, day], strategy_state])
        )
        
        # æ›´æ–°ç­–ç•¥çŠ¶æ€ï¼ˆä½¿ç”¨å¯å¾®åˆ†çš„æœŸæœ›ä»“ä½ï¼‰
        expected_position = position_output['positions']
        strategy_state = self.gru_cell(
            cat([price_features_sequence[:, day], expected_position]),
            strategy_state
        )
    
    return all_positions  # 20å¤©çš„ä»“ä½å†³ç­–
```

### ç­–ç•¥æŸå¤±è®¡ç®—
```python
def calculate_strategy_loss(positions, returns):
    # 1. ç›¸å¯¹åŸºå‡†æ”¶ç›Š
    strategy_return = sum(positions * returns)
    benchmark_return = sum(benchmark_positions * returns)
    relative_return = strategy_return - benchmark_return
    
    # 2. é£é™©æˆæœ¬
    volatility_cost = std(positions * returns)
    drawdown_cost = max_drawdown(positions * returns)
    
    # 3. æœºä¼šæˆæœ¬ï¼ˆåŸºäºå¸‚åœºç±»å‹ï¼‰
    market_type = classify_market(returns)
    opportunity_cost = calculate_opportunity_cost(positions, returns, market_type)
    
    return -relative_return + risk_weight * (volatility_cost + drawdown_cost) + opportunity_cost
```

## ğŸ‰ é‡ç»„æˆæœ

### âœ… è§£å†³çš„é—®é¢˜
1. **æ¢¯åº¦é˜»æ–­é—®é¢˜** - ä¸¤ä¸ªç½‘ç»œç‹¬ç«‹ä¼˜åŒ–
2. **å†…å­˜æ•ˆç‡é—®é¢˜** - ä»·æ ¼ç½‘ç»œå¹¶è¡Œè®­ç»ƒï¼Œç­–ç•¥ç½‘ç»œè½»é‡åŒ–
3. **ç›®æ ‡å†²çªé—®é¢˜** - ä¸“ä¸šåŒ–æŸå¤±å‡½æ•°
4. **è°ƒä¼˜å›°éš¾é—®é¢˜** - ç‹¬ç«‹è°ƒå‚å’Œéƒ¨ç½²

### ğŸš€ æ–°å¢èƒ½åŠ›
1. **æ¨¡å—åŒ–è®¾è®¡** - å¯ä»¥ç‹¬ç«‹æ›¿æ¢ä»·æ ¼æˆ–ç­–ç•¥ç½‘ç»œ
2. **ä¸“ä¸šåŒ–ä¼˜åŒ–** - æ¯ä¸ªç½‘ç»œä¸“æ³¨è‡ªå·±çš„ä»»åŠ¡
3. **çµæ´»éƒ¨ç½²** - å¯ä»¥åªéƒ¨ç½²ä»·æ ¼ç½‘ç»œæˆ–åªéƒ¨ç½²ç­–ç•¥ç½‘ç»œ
4. **æ˜“äºæ‰©å±•** - å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„ç­–ç•¥ç½‘ç»œå˜ä½“

### ğŸ“ˆ é¢„æœŸæ”¶ç›Š
- **è®­ç»ƒæ•ˆç‡**: æå‡2-3å€
- **æ¨¡å‹æ€§èƒ½**: ä¸“ä¸šåŒ–ä¼˜åŒ–å¸¦æ¥æ›´å¥½æ•ˆæœ
- **ç»´æŠ¤æˆæœ¬**: é™ä½50%ï¼ˆæ¨¡å—åŒ–è®¾è®¡ï¼‰
- **æ‰©å±•èƒ½åŠ›**: æå‡æ˜¾è‘—ï¼ˆè§£è€¦æ¶æ„ï¼‰

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»æ—§ç‰ˆæœ¬è¿ç§»
```bash
# æ—§ç‰ˆæœ¬ï¼ˆå·²åºŸå¼ƒï¼‰
python train.py  # è€¦åˆè®­ç»ƒ

# æ–°ç‰ˆæœ¬
python train.py  # ä¸¤é˜¶æ®µè®­ç»ƒ
```

### ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹
```python
# åŠ è½½ä»·æ ¼ç½‘ç»œ
price_net = load_price_network('best_price_network.pth')
features = price_net.extract_features(financial_data)

# åŠ è½½ç­–ç•¥ç½‘ç»œ
strategy_net = load_strategy_network('best_strategy_network.pth')
positions = strategy_net.forward_sequence(features)
```

---

**ğŸ¯ é¡¹ç›®é‡ç»„å®Œæˆï¼ç°åœ¨æ‹¥æœ‰æ¸…æ™°ã€é«˜æ•ˆã€ä¸“ä¸šåŒ–çš„ä¸¤é˜¶æ®µè®­ç»ƒæ¶æ„ï¼**

*é‡ç»„æ‰§è¡Œè€…: AI Assistant*  
*é‡ç»„æ—¥æœŸ: 2025å¹´1æœˆ*  
*é¡¹ç›®çŠ¶æ€: æ¶æ„å‡çº§å®Œæˆ*
